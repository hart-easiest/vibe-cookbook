<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ספר המתכונים של טל</title>

  <!-- PWA / iOS Home Screen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="המתכונים שלי">
  <link rel="apple-touch-icon" href="icon.svg">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <meta name="theme-color" content="#fdf8f3">

  <!-- Prevent aggressive caching on iOS PWA -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <!-- Firebase Storage removed - requires paid plan -->

  <link rel="stylesheet" href="styles.css?v=d4e81ab">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-top">
        <h1>ספר המתכונים של טל</h1>
        <button class="auth-btn" id="auth-btn" title="התחברות">👤</button>
        <button class="settings-btn" id="settings-btn" title="הגדרות">⚙️</button>
      </div>
      <div class="search-container">
        <input type="search" id="search-input" placeholder="חיפוש מתכונים..." autocomplete="off">
        <button id="clear-search" class="clear-btn" aria-label="נקה חיפוש">&times;</button>
      </div>
    </header>

    <!-- Categories Navigation -->
    <nav class="categories-nav" id="categories-nav">
      <!-- Categories will be populated by JS -->
    </nav>

    <!-- Tags Filter -->
    <div class="tags-filter" id="tags-filter">
      <div class="tags-filter-label">סינון לפי תגיות:</div>
      <div class="tags-filter-pills" id="tags-filter-pills">
        <!-- Tags will be populated by JS -->
      </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
      <span class="recipe-count" id="recipe-count"></span>
      <button class="add-recipe-btn" id="add-recipe-btn">
        <span>+</span> הוסף מתכון
      </button>
    </div>

    <!-- Main Content -->
    <main class="recipes-container" id="recipes-container">
      <!-- Recipes will be populated by JS -->
    </main>

    <!-- Recipe Modal -->
    <div class="modal" id="recipe-modal">
      <div class="modal-content">
        <div class="modal-header-bar">
          <button class="modal-close" id="modal-close">&times;</button>
          <button class="modal-delete" id="modal-delete" title="מחק מתכון">🗑️</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Recipe details will be populated by JS -->
        </div>
      </div>
    </div>

    <!-- Add Recipe Modal -->
    <div class="modal" id="add-modal">
      <div class="modal-content add-modal-content">
        <button class="modal-close" id="add-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">הוסף מתכון חדש</h2>

          <div class="form-tabs">
            <button class="form-tab active" data-tab="link">קישור</button>
            <button class="form-tab" data-tab="text">טקסט</button>
            <!-- Image tab disabled - requires Firebase Storage (paid plan) -->
          </div>

          <form id="add-recipe-form">
            <!-- Link Tab -->
            <div class="form-tab-content active" data-tab="link">
              <div class="form-group">
                <label for="recipe-url">קישור למתכון</label>
                <input type="url" id="recipe-url" placeholder="https://www.instagram.com/reel/..." dir="ltr">
              </div>
              <div class="form-group">
                <label for="recipe-name-link">שם המתכון</label>
                <input type="text" id="recipe-name-link" placeholder="שם המתכון">
              </div>
            </div>

            <!-- Text Tab -->
            <div class="form-tab-content" data-tab="text">
              <div class="form-group">
                <label for="recipe-name-text">שם המתכון</label>
                <input type="text" id="recipe-name-text" placeholder="שם המתכון">
              </div>
              <div class="form-group">
                <label for="recipe-text">תוכן המתכון</label>
                <textarea id="recipe-text" rows="8" placeholder="הכניסי את המתכון כאן..."></textarea>
              </div>
            </div>

            <!-- Image Tab removed - requires Firebase Storage (paid plan) -->

            <!-- Common Fields -->
            <div class="form-group">
              <label for="recipe-category">קטגוריה</label>
              <select id="recipe-category">
                <!-- Will be populated by JS -->
              </select>
            </div>

            <div class="form-group">
              <label for="recipe-notes">הערות (אופציונלי)</label>
              <input type="text" id="recipe-notes" placeholder="הערות נוספות...">
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-add">ביטול</button>
              <button type="submit" class="btn btn-primary" id="submit-add">
                <span class="btn-text">הוסף מתכון</span>
                <span class="btn-loading" style="display:none;">מעבד...</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
      <div class="modal-content delete-modal-content">
        <div class="modal-body" style="text-align: center; padding: 30px;">
          <div style="font-size: 3rem; margin-bottom: 16px;">🗑️</div>
          <h3 style="margin-bottom: 8px;">למחוק את המתכון?</h3>
          <p id="delete-recipe-name" style="color: var(--text-secondary); margin-bottom: 24px;"></p>
          <div class="form-actions" style="justify-content: center;">
            <button class="btn btn-secondary" id="cancel-delete">ביטול</button>
            <button class="btn btn-danger" id="confirm-delete">מחק</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Transcription Modal -->
    <div class="modal" id="transcription-modal">
      <div class="modal-content transcription-modal-content">
        <button class="modal-close" id="transcription-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">📝 העלאת טקסט ידנית</h2>
          <p class="modal-subtitle">הזיני את טקסט המתכון כדי לחפש בו בקלות</p>

          <div class="form-group">
            <label for="transcription-text">טקסט המתכון</label>
            <textarea id="transcription-text" rows="10" placeholder="הכניסי כאן את טקסט המתכון..."></textarea>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-transcription">ביטול</button>
            <button type="button" class="btn btn-primary" id="save-transcription">
              <span class="btn-text">שמור טקסט</span>
              <span class="btn-loading" style="display:none;">שומר...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Image Modal removed - requires Firebase Storage (paid plan) -->

    <!-- Edit Tags Modal -->
    <div class="modal" id="edit-tags-modal">
      <div class="modal-content transcription-modal-content">
        <button class="modal-close" id="edit-tags-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">🏷️ ערוך תגיות</h2>
          <p class="modal-subtitle">בחרי תגיות למתכון זה</p>

          <div class="tags-editor" id="tags-editor">
            <!-- Tags will be populated by JS -->
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-edit-tags">ביטול</button>
            <button type="button" class="btn btn-primary" id="save-edit-tags">
              <span class="btn-text">שמור תגיות</span>
              <span class="btn-loading" style="display:none;">שומר...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Recipe Details Modal -->
    <div class="modal" id="edit-category-modal">
      <div class="modal-content transcription-modal-content">
        <button class="modal-close" id="edit-category-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">✏️ ערוך פרטי מתכון</h2>
          <p class="modal-subtitle">עדכני את שם המתכון והקטגוריה</p>

          <div class="form-group">
            <label for="edit-recipe-name">שם המתכון</label>
            <input type="text" id="edit-recipe-name" placeholder="שם המתכון">
          </div>

          <div class="form-group">
            <label for="edit-category-select">קטגוריה</label>
            <select id="edit-category-select">
              <!-- Will be populated by JS -->
            </select>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-edit-category">ביטול</button>
            <button type="button" class="btn btn-primary" id="save-edit-category">
              <span class="btn-text">שמור שינויים</span>
              <span class="btn-loading" style="display:none;">שומר...</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Manage Categories Modal -->
    <div class="modal" id="manage-categories-modal">
      <div class="modal-content settings-modal-content">
        <button class="modal-close" id="manage-categories-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">📂 ניהול קטגוריות</h2>

          <div class="categories-manager" id="categories-manager">
            <!-- Categories will be populated by JS -->
          </div>

          <div class="add-category-section">
            <h3>הוסף קטגוריה ראשית חדשה</h3>
            <div class="add-category-form">
              <input type="text" id="new-main-category-name" placeholder="שם הקטגוריה">
              <input type="text" id="new-main-category-icon" placeholder="אימוג'י" maxlength="2" style="width: 60px;">
              <button type="button" class="btn btn-primary btn-small" id="add-main-category-btn">הוסף</button>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="close-manage-categories">סגור</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="auth-modal">
      <div class="modal-content auth-modal-content">
        <button class="modal-close" id="auth-modal-close">&times;</button>
        <div class="modal-body">
          <div id="auth-signed-out">
            <h2 class="modal-title">👤 התחברות</h2>
            <p class="modal-subtitle">התחברי עם חשבון Google כדי להוסיף ולערוך מתכונים</p>
            <button class="google-signin-btn" id="google-signin-btn">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              התחבר עם Google
            </button>
          </div>
          <div id="auth-signed-in" style="display: none;">
            <h2 class="modal-title">👋 שלום!</h2>
            <div class="auth-user-info">
              <img id="auth-user-photo" src="" alt="User photo" class="auth-user-photo">
              <div class="auth-user-details">
                <div id="auth-user-name" class="auth-user-name"></div>
                <div id="auth-user-email" class="auth-user-email"></div>
              </div>
            </div>
            <div id="auth-permission-status" class="auth-permission-status"></div>
            <button class="btn btn-secondary" id="signout-btn" style="margin-top: 20px;">התנתק</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
      <div class="modal-content settings-modal-content">
        <button class="modal-close" id="settings-modal-close">&times;</button>
        <div class="modal-body">
          <h2 class="modal-title">⚙️ הגדרות</h2>

          <div class="settings-section" id="categories-settings-section">
            <h3>📂 קטגוריות</h3>
            <p class="settings-desc">נהלי קטגוריות ותת-קטגוריות</p>
            <button type="button" class="btn btn-secondary" id="open-manage-categories">ניהול קטגוריות</button>
          </div>

          <div class="settings-section">
            <h3>🌙 מצב תצוגה</h3>
            <p class="settings-desc">בחרי בין מצב בהיר לכהה</p>
            <div class="theme-toggle">
              <button type="button" class="theme-btn" data-theme="light" id="theme-light">☀️ בהיר</button>
              <button type="button" class="theme-btn" data-theme="dark" id="theme-dark">🌙 כהה</button>
              <button type="button" class="theme-btn active" data-theme="auto" id="theme-auto">🔄 אוטומטי</button>
            </div>
          </div>

          <div class="settings-section">
            <h3>🤖 OpenAI API</h3>
            <p class="settings-desc">הזיני מפתח API של OpenAI לתמלול אוטומטי של סרטונים</p>
            <div class="form-group">
              <label for="openai-key">מפתח API</label>
              <input type="password" id="openai-key" placeholder="sk-..." dir="ltr">
            </div>
            <p class="settings-note">המפתח נשמר מקומית בדפדפן שלך בלבד</p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-settings">ביטול</button>
            <button type="button" class="btn btn-primary" id="save-settings">שמור הגדרות</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>טוען מתכונים...</p>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>
  </div>

  <script src="app.js?v=d4e81ab"></script>
</body>
</html>
